{{ define "main" }}
<div class="favorites-container">
  <!-- Search Box -->
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search favorites..." onkeyup="searchFavorites()">
  </div>

  <!-- Sort Buttons -->
  <div class="sort-buttons">
    <button onclick="sortFavorites('id', 'asc')">Sort by ID ↑</button>
    <button onclick="sortFavorites('id', 'desc')">Sort by ID ↓</button>
    <button onclick="sortFavorites('domain', 'asc')">Sort by Domain A-Z</button>
    <button onclick="sortFavorites('domain', 'desc')">Sort by Domain Z-A</button>
    <button onclick="sortFavorites('title', 'asc')">Sort by Title A-Z</button>
    <button onclick="sortFavorites('title', 'desc')">Sort by Title Z-A</button>
  </div>

  <!-- Favorites List -->
  <div class="favorites-list" id="favoritesList">
    {{ range .Pages }}
    <div class="favorite-item" 
         data-id="{{ with .File }}{{ .BaseFileName }}{{ end }}"
         data-domain="{{ .Params.url | replaceRE "^https?://([^/]+).*" "$1" }}"
         data-title="{{ .Title | lower }}">
      <div class="favicon">
        {{ if .Params.url }}
        <img src="https://www.google.com/s2/favicons?domain={{ .Params.url }}&sz=32" alt="Favicon">
        {{ end }}
      </div>
      <div class="favorite-content">
        <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
        {{ if .Params.url }}
        <div class="url"><a href="{{ .Params.url }}" target="_blank">{{ .Params.url }}</a></div>
        {{ end }}
        {{ if .Description }}
        <div class="description">{{ .Description }}</div>
        {{ end }}
      </div>
    </div>
    {{ end }}
  </div>
</div>

<style>
  /* Same CSS as before */
  .favorites-container {
    max-width: 800px;
    margin: 0 auto;
  }
  .search-box {
    margin: 20px 0;
  }
  .search-box input {
    width: 100%;
    padding: 8px;
    font-size: 16px;
  }
  .sort-buttons {
    margin-bottom: 20px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .sort-buttons button {
    padding: 8px 12px;
    cursor: pointer;
  }
  .favorites-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .favorite-item {
    display: flex;
    gap: 15px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    align-items: center;
  }
  .favicon img {
    width: 32px;
    height: 32px;
  }
  .favorite-content {
    flex-grow: 1;
  }
  .url {
    color: #666;
    font-size: 0.9em;
    margin: 5px 0;
  }
  .description {
    color: #444;
  }
</style>

<script>
  // Search function
  function searchFavorites() {
    const input = document.getElementById('searchInput');
    const filter = input.value.toLowerCase();
    const items = document.querySelectorAll('.favorite-item');

    items.forEach(item => {
      const text = item.textContent.toLowerCase();
      item.style.display = text.includes(filter) ? 'flex' : 'none';
    });
  }

  // Improved sort function
  function sortFavorites(key, direction) {
    const container = document.getElementById('favoritesList');
    const items = Array.from(document.querySelectorAll('.favorite-item'));

    items.sort((a, b) => {
      let aValue = a.getAttribute(`data-${key}`);
      let bValue = b.getAttribute(`data-${key}`);

      // Convert to number if sorting by ID
      if (key === 'id') {
        aValue = parseInt(aValue) || 0;
        bValue = parseInt(bValue) || 0;
      }

      // Handle empty values
      if (!aValue) return direction.includes('asc') ? 1 : -1;
      if (!bValue) return direction.includes('asc') ? -1 : 1;

      // Perform comparison
      if (aValue > bValue) return direction.includes('asc') ? 1 : -1;
      if (aValue < bValue) return direction.includes('asc') ? -1 : 1;
      return 0;
    });

    // Clear and re-append sorted items
    container.innerHTML = '';
    items.forEach(item => container.appendChild(item));
  }

  // Initial sort by ID ascending
  document.addEventListener('DOMContentLoaded', () => {
    sortFavorites('id', 'asc');
  });
</script>
{{ end }}
